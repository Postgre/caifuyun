package com.zepan.android.widget;import android.content.Context;import android.content.res.TypedArray;import android.os.CountDownTimer;import android.util.AttributeSet;import android.view.View;import android.widget.Button;import android.widget.Toast;import com.zepan.android.sdk.R;/** * 可倒计时的button * */public class CountDownButton extends Button{	/** 倒计时结束后按钮文字*/	private static final String END_TEXT = "重新发送";	/** 单位*/	private static final String UNIT = "秒";	/** 倒计时总时间*/	private static final int MILLIS_IN_FUTURE = 6000;	/** 倒计时时间间隔*/	private int DOWN_INTERVAL = 1000;	// 倒计时结束文字	// 按钮点击事件	private OnClickListener mLisener = null;	// 计时器	private CountDownTimer mTimer = null;	// 构造方法	public CountDownButton(final Context context, AttributeSet attrs) {		super(context, attrs);		// 从Xml中取属性值并赋值给当前属性		TypedArray a = context.obtainStyledAttributes(attrs,                     R.styleable.CountDownButton); 		final String endText = a.getString(R.styleable.CountDownButton_endText) != null ? a.getString(R.styleable.CountDownButton_endText) : END_TEXT;		final String unit = a.getString(R.styleable.CountDownButton_unit) != null ? a.getString(R.styleable.CountDownButton_unit) : UNIT;		int millis = a.getInteger(R.styleable.CountDownButton_millisInFuture, MILLIS_IN_FUTURE);		final int interval = a.getInteger(R.styleable.CountDownButton_countDownInterval, DOWN_INTERVAL);		a.recycle();		// 如果总时间不能整除间隔时间，提示错误		if(millis % interval != 0){			Toast.makeText(context, "倒计时控件总时间不能整除间隔时间", Toast.LENGTH_SHORT).show();			return;		}		// 设置timer		mTimer = new CountDownTimer(millis, interval){			@Override			public void onFinish() {				CountDownButton.this.setEnabled(true);				CountDownButton.this.setText(endText);			}			@Override			public void onTick(long millisUntilFinished) {				CountDownButton.this.setEnabled(false);				// 如果总时间不能整除间隔时间，提示错误				CountDownButton.this.setText(millisUntilFinished / interval + unit);			}		};		// 设置点击事件		this.setOnClickListener(new View.OnClickListener() {			@Override			public void onClick(View v) {				mTimer.start();				if(mLisener != null){					mLisener.onClick(CountDownButton.this);				}			}		});	}		/**	 * 设置点击回调事件	 * @see OnClickListener	 * */	public void setOnClickListener(OnClickListener listener){		this.mLisener = listener;	}	/** 定义回调接口*/	public interface OnClickListener{		void onClick(View view);	}}